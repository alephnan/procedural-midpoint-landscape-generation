(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var Node = (function () {
    function Node(data) {
        this.prev = null;
        this.next = null;
        this.data = data;
    }
    return Node;
}());
exports.Node = Node;
var LinkedList = (function () {
    function LinkedList() {
        this.first = null;
        this.last = null;
        this.length_ = 0;
    }
    LinkedList.prototype.length = function () {
        return this.length_;
    };
    LinkedList.prototype.get = function (index) {
        return this.getNode(index).data;
    };
    LinkedList.prototype.getNode = function (index) {
        var i = 0;
        var curr = this.first;
        while (curr != null) {
            if (i == index) {
                break;
            }
            curr = curr.next;
            i++;
        }
        if (i != index) {
            throw Error('Invalid index');
        }
        return curr;
    };
    LinkedList.prototype.pop = function () {
        if (!(this.first)) {
            throw new Error("Nothing to pop");
        }
        var node = this.first;
        if (node.next == null) {
            this.first = null;
        }
        else {
            this.first = node.next;
            this.first.prev = null;
        }
        this.length_--;
        return node.data;
    };
    LinkedList.prototype.push = function (e) {
        var n = new Node(e);
        if (this.last == null) {
            this.first = n;
            this.last = n;
        }
        else {
            this.last.next = n;
            n.prev = this.last;
            this.last = n;
        }
        this.length_++;
    };
    LinkedList.prototype.peekLast = function () {
        return this.last.data;
    };
    LinkedList.prototype.forEach = function (f) {
        var i = 0;
        var curr = this.first;
        while (curr != null) {
            f(curr.data);
            curr = curr.next;
            i++;
        }
    };
    LinkedList.prototype.splitAt = function (index, split) {
        if (index < 0) {
            throw Error();
        }
        if (this.first == null) {
            throw Error('Invalid index');
        }
        if (this.first.next == null && index != 0) {
            throw Error('Index DNE');
        }
        if (index >= this.length()) {
            throw Error('Index out bounds');
        }
        this.length_++;
        var leftNode = new Node(split.x);
        var rightNode = new Node(split.y);
        leftNode.next = rightNode;
        rightNode.prev = leftNode;
        if (this.first.next == null) {
            this.first = leftNode;
            this.last = rightNode;
        }
        else if (index == 0) {
            var next = this.first.next;
            rightNode.next = next;
            this.first = leftNode;
            next.prev = rightNode;
        }
        else if (index == this.length() - 2) {
            this.last.prev.next = leftNode;
            leftNode.prev = this.last.prev;
            this.last = rightNode;
        }
        else {
            var curr = this.getNode(index);
            var prev = curr.prev;
            var next = curr.next;
            leftNode.prev = prev;
            rightNode.next = next;
            prev.next = leftNode;
            next.prev = rightNode;
        }
    };
    return LinkedList;
}());
exports.LinkedList = LinkedList;

},{}],2:[function(require,module,exports){
"use strict";
var scrolling_midpoint_displacer_linkedlist_1 = require("./scrolling-midpoint-displacer-linkedlist");
var sketch = function (p) {
    var W = 600;
    var H = 400;
    var mdp = new scrolling_midpoint_displacer_linkedlist_1.ScrollingMidpointDisplacerLinkedList(10, W, H);
    p.setup = function () {
        p.createCanvas(W, H);
        p.background(p.color('yellow'));
        p.stroke(p.color('red'));
        p.strokeWeight(2);
        p.frameRate(10);
    };
    p.draw = function () {
        p.background(p.color('yellow'));
        mdp.update();
        mdp.render(p);
    };
};
new p5(sketch, false, false);

},{"./scrolling-midpoint-displacer-linkedlist":4}],3:[function(require,module,exports){
"use strict";
var Pair = (function () {
    function Pair(x, y) {
        this.x = x;
        this.y = y;
    }
    Pair.prototype.toString = function () {
        return "Pair(" + this.x + "," + this.y + ")";
    };
    Pair.prototype.shallowClone = function () {
        return new Pair(this.x, this.y);
    };
    return Pair;
}());
exports.Pair = Pair;

},{}],4:[function(require,module,exports){
"use strict";
var pair_1 = require("./pair");
var splittable_line_1 = require("./splittable-line");
var linked_list_1 = require("./linked-list");
var ScrollingMidpointDisplacerLinkedList = (function () {
    function ScrollingMidpointDisplacerLinkedList(initialResolution, w, h) {
        var lines = new linked_list_1.LinkedList();
        this.lineSegments = lines;
        var p1 = new pair_1.Pair(0, 150);
        var p2 = new pair_1.Pair(w / 4, 250);
        var baseDisplacement = p1.y - p2.y;
        var l = new splittable_line_1.SplittableLine(p1, p2, 0, baseDisplacement);
        lines.push(l);
        this.w = w;
        this.h = h;
        this.verticalBound = new pair_1.Pair(0, this.h);
        for (var i = 0; i < 20; i++) {
            this.propagate();
        }
        this.iterations = 0;
    }
    ScrollingMidpointDisplacerLinkedList.prototype.render = function (p) {
        this.lineSegments.forEach(function (l) {
            p.line(l.a.x, l.a.y, l.b.x, l.b.y);
        });
    };
    ScrollingMidpointDisplacerLinkedList.prototype.propagate = function () {
        var lines = this.lineSegments;
        var i = this.lineSegments.length() - 1;
        while (i >= 0) {
            var l = lines.get(i);
            if (!ScrollingMidpointDisplacerLinkedList.skipSplittableLine(l)) {
                var split = l.getSplit(this.verticalBound);
                lines.splitAt(i, split);
            }
            i--;
        }
    };
    ScrollingMidpointDisplacerLinkedList.prototype.update = function () {
        this.iterations++;
        this.lineSegments.pop();
        this.propagate();
        if (this.iterations % 70 == 0) {
            var last = this.lineSegments.peekLast();
            var beginCoordinate = last.b.shallowClone();
            var endCoordinate = new pair_1.Pair(this.w / 4 * (1 + (this.iterations / 70)), Math.floor(this.h * Math.random()));
            var newLine = new splittable_line_1.SplittableLine(beginCoordinate, endCoordinate, 0, beginCoordinate.y - endCoordinate.y);
            this.lineSegments.push(newLine);
        }
    };
    ScrollingMidpointDisplacerLinkedList.skipSplittableLine = function (l) {
        return l.b.x - l.a.x < 2;
    };
    return ScrollingMidpointDisplacerLinkedList;
}());
ScrollingMidpointDisplacerLinkedList.ROUGHNESS = .8;
exports.ScrollingMidpointDisplacerLinkedList = ScrollingMidpointDisplacerLinkedList;

},{"./linked-list":1,"./pair":3,"./splittable-line":5}],5:[function(require,module,exports){
"use strict";
var pair_1 = require("./pair");
var SplittableLine = (function () {
    function SplittableLine(a, b, generation, baseDisplacement) {
        this.a = a;
        this.b = b;
        this.generation = generation;
        this.baseDisplacement = baseDisplacement;
    }
    SplittableLine.prototype.toString = function () {
        return "Line(" + this.a.toString() + "->" + this.b.toString() + ")";
    };
    SplittableLine.prototype.getMidpoint = function () {
        var x = (this.b.x + this.a.x) / 2;
        var y = (this.b.y + this.a.y) / 2;
        return new pair_1.Pair(x, y);
    };
    SplittableLine.prototype.nextDisplacementMagnitude = function () {
        var baseDisplacementScale = Math.pow(2, (-1 * SplittableLine.ROUGHNESS));
        var displacementScale = Math.pow(baseDisplacementScale, this.generation);
        return this.baseDisplacement * displacementScale;
    };
    SplittableLine.prototype.getGeneration = function () {
        return this.generation;
    };
    SplittableLine.prototype.getBaseDisplacement = function () {
        return this.baseDisplacement;
    };
    SplittableLine.prototype.getSplit = function (verticalBound) {
        var displacementMagnitude = this.nextDisplacementMagnitude();
        var leftPoint = this.a;
        var rightPoint = this.b;
        var midpoint = this.getMidpoint();
        var verticallyDisplacedMidpoint = this.displacePointVertically(midpoint, displacementMagnitude, verticalBound);
        var generation = this.getGeneration() + 1;
        var baseDisplacement = this.getBaseDisplacement();
        var leftSplittableLine = new SplittableLine(leftPoint, verticallyDisplacedMidpoint, generation, baseDisplacement);
        var rightSplittableLine = new SplittableLine(verticallyDisplacedMidpoint, rightPoint, generation, baseDisplacement);
        return new pair_1.Pair(leftSplittableLine, rightSplittableLine);
    };
    SplittableLine.prototype.displacePointVertically = function (p, displaceMagnitude, verticalBound) {
        var y = p.y + this.choose([displaceMagnitude, -displaceMagnitude]);
        y = this.clamp(y, verticalBound.x, verticalBound.y);
        return new pair_1.Pair(p.x, y);
    };
    SplittableLine.prototype.choose = function (choices) {
        return choices[Math.floor(Math.random() * choices.length)];
    };
    SplittableLine.prototype.clamp = function (x, lowerBound, upperBound) {
        return Math.min(upperBound, Math.max(x, lowerBound));
    };
    return SplittableLine;
}());
SplittableLine.ROUGHNESS = .6;
exports.SplittableLine = SplittableLine;

},{"./pair":3}]},{},[2])

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbGlua2VkLWxpc3QudHMiLCJzcmMvbWFpbi50cyIsInNyYy9wYWlyLnRzIiwic3JjL3Njcm9sbGluZy1taWRwb2ludC1kaXNwbGFjZXItbGlua2VkbGlzdC50cyIsInNyYy9zcGxpdHRhYmxlLWxpbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDTUE7SUFLRSxjQUFZLElBQVM7UUFDbkIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbkIsQ0FBQztJQUNILFdBQUM7QUFBRCxDQVZBLEFBVUMsSUFBQTtBQVZZLG9CQUFJO0FBWWpCO0lBS0U7UUFDRSxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztJQUNuQixDQUFDO0lBRUQsMkJBQU0sR0FBTjtRQUNFLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3RCLENBQUM7SUFFRCx3QkFBRyxHQUFILFVBQUksS0FBYTtRQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNsQyxDQUFDO0lBR08sNEJBQU8sR0FBZixVQUFnQixLQUFhO1FBQzNCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNWLElBQUksSUFBSSxHQUFVLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDN0IsT0FBTSxJQUFJLElBQUksSUFBSSxFQUFFLENBQUM7WUFDbkIsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ2QsS0FBSyxDQUFDO1lBQ1IsQ0FBQztZQUNE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biBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqXG4gKiBEb3VibHkgTGlua2VkIExpc3QgRGF0YSBzdHJ1Y3R1cmVcbiAqL1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL2xpbmUnO1xuaW1wb3J0IHtQYWlyfSBmcm9tICcuL3BhaXInO1xuXG5leHBvcnQgY2xhc3MgTm9kZSB7XG4gIHB1YmxpYyBkYXRhOiBhbnk7XG4gIHB1YmxpYyBwcmV2OiBOb2RlO1xuICBwdWJsaWMgbmV4dDogTm9kZTtcblxuICBjb25zdHJ1Y3RvcihkYXRhOiBhbnkpIHtcbiAgICB0aGlzLnByZXYgPSBudWxsO1xuICAgIHRoaXMubmV4dCA9IG51bGw7XG4gICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTGlua2VkTGlzdCB7XG4gIHByaXZhdGUgZmlyc3Q6IE5vZGU7XG4gIHByaXZhdGUgbGFzdDogTm9kZTtcbiAgcHJpdmF0ZSBsZW5ndGhfOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5maXJzdCA9IG51bGw7XG4gICAgdGhpcy5sYXN0ID0gbnVsbDtcbiAgICB0aGlzLmxlbmd0aF8gPSAwO1xuICB9XG5cbiAgbGVuZ3RoKCkgOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmxlbmd0aF87XG4gIH1cblxuICBnZXQoaW5kZXg6IG51bWJlcikgOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmdldE5vZGUoaW5kZXgpLmRhdGE7XG4gIH1cblxuICAvLyBUT0RPKGF1dG9tYXR3b24pOiBMb29wIGJhY2t3YXJkIGZyb20gZW5kIGlmIGNsb3NlciB0byBpbmRleC5cbiAgcHJpdmF0ZSBnZXROb2RlKGluZGV4OiBudW1iZXIpIDogTm9kZSB7XG4gICAgbGV0IGkgPSAwO1xuICAgIGxldCBjdXJyIDogTm9kZSA9IHRoaXMuZmlyc3Q7XG4gICAgd2hpbGUoY3VyciAhPSBudWxsKSB7XG4gICAgICBpZihpID09IGluZGV4KSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY3VyciA9IGN1cnIubmV4dDtcbiAgICAgIGkrKztcbiAgICB9XG5cbiAgICBpZihpICE9IGluZGV4KSB7XG4gICAgICB0aHJvdyBFcnJvcignSW52YWxpZCBpbmRleCcpO1xuICAgIH1cbiAgICByZXR1cm4gY3VycjtcbiAgfVxuXG4gIC8vIFRocm93cyBudWxsIHBvaW50ZXIgaWYgbm8gZWxlbWVudCB0byBwb3BcbiAgcG9wKCkgOiBMaW5lIHtcbiAgICBpZighKHRoaXMuZmlyc3QpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3RoaW5nIHRvIHBvcFwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBub2RlID0gdGhpcy5maXJzdDtcbiAgICBpZihub2RlLm5leHQgPT0gbnVsbCkge1xuICAgICAgdGhpcy5maXJzdCA9IG51bGxcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5maXJzdCA9IG5vZGUubmV4dDtcbiAgICAgIHRoaXMuZmlyc3QucHJldiA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMubGVuZ3RoXy0tO1xuICAgIHJldHVybiBub2RlLmRhdGE7XG4gIH1cblxuICAvLyBiZSBzdHJpY3RlciBhYm91dCB0aGUgdHlwZSB0byBlOiBMaW5lYFxuICBwdXNoKGU6IGFueSkge1xuICAgIGNvbnN0IG4gPSBuZXcgTm9kZShlKTtcbiAgICBpZih0aGlzLmxhc3QgPT0gbnVsbCkge1xuICAgICAgdGhpcy5maXJzdCA9IG47XG4gICAgICB0aGlzLmxhc3QgPSBuO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxhc3QubmV4dCA9IG47XG4gICAgICBuLnByZXYgPSB0aGlzLmxhc3Q7XG4gICAgICB0aGlzLmxhc3QgPSBuO1xuICAgIH1cblxuICAgIHRoaXMubGVuZ3RoXysrO1xuICB9XG5cbiAgLy8gVE9ETyhhdXRvbWF0d29uKTogYWRkIHBlZWtGaXJzdFxuXG4gIHBlZWtMYXN0KCkgOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmxhc3QuZGF0YTtcbiAgfVxuXG4gIGZvckVhY2goZjogRnVuY3Rpb24pIDogdm9pZCB7XG4gICAgbGV0IGkgPSAwO1xuICAgIGxldCBjdXJyIDogTm9kZSA9IHRoaXMuZmlyc3Q7XG4gICAgd2hpbGUoY3VyciAhPSBudWxsKSB7XG4gICAgICBmKGN1cnIuZGF0YSk7XG4gICAgICBjdXJyID0gY3Vyci5uZXh0O1xuICAgICAgaSsrO1xuICAgIH1cbiAgfVxuXG4gIHNwbGl0QXQoaW5kZXg6IG51bWJlciwgIHNwbGl0OiBQYWlyPExpbmU+KSB7XG4gICAgLy8gVE9ETyhhdXRvbWF0d29uKTogRGlzYWJsZSB0aGVzZSBkZWZlbnNpdmUgY2hlY2tzIGZvciBwZXJmb3JtYW5jZVxuICAgIGlmKGluZGV4IDwgMCkge1xuICAgICAgdGhyb3cgRXJyb3IoKTtcbiAgICB9XG4gICAgaWYodGhpcy5maXJzdCA9PSBudWxsKSB7XG4gICAgICB0aHJvdyBFcnJvcignSW52YWxpZCBpbmRleCcpO1xuICAgIH1cbiAgICBpZih0aGlzLmZpcnN0Lm5leHQgPT0gbnVsbCAmJiBpbmRleCAhPSAwKSB7XG4gICAgICB0aHJvdyBFcnJvcignSW5kZXggRE5FJyk7XG4gICAgfVxuICAgIGlmKGluZGV4ID49IHRoaXMubGVuZ3RoKCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdJbmRleCBvdXQgYm91bmRzJyk7XG4gICAgfVxuICAgIFxuICAgIC8vIFJlcGxhY2Ugb25lIGVsZW1lbnQgd2l0aCB0d29cbiAgICB0aGlzLmxlbmd0aF8rKztcblxuICAgIC8vIExpbmsgdGhlIGVsZW1lbnRzXG4gICAgY29uc3QgbGVmdE5vZGUgPSBuZXcgTm9kZShzcGxpdC54KTtcbiAgICBjb25zdCByaWdodE5vZGUgPSBuZXcgTm9kZShzcGxpdC55KTtcbiAgICBsZWZ0Tm9kZS5uZXh0ID0gcmlnaHROb2RlO1xuICAgIHJpZ2h0Tm9kZS5wcmV2ID0gbGVmdE5vZGU7XG5cbiAgICBpZih0aGlzLmZpcnN0Lm5leHQgPT0gbnVsbCkgeyAvLyAxIGVsZW1lbnRcbiAgICAgIHRoaXMuZmlyc3QgPSBsZWZ0Tm9kZTtcbiAgICAgIHRoaXMubGFzdCA9IHJpZ2h0Tm9kZTtcbiAgICB9IGVsc2UgaWYoaW5kZXggPT0gMCkgeyAvLyBGaXJzdCBFbGVtZW50XG4gICAgICBjb25zdCBuZXh0ID0gdGhpcy5maXJzdC5uZXh0XG4gICAgICByaWdodE5vZGUubmV4dCA9IG5leHQ7XG4gICAgICB0aGlzLmZpcnN0ID0gbGVmdE5vZGU7XG4gICAgICBuZXh0LnByZXYgPSByaWdodE5vZGU7XG4gICAgfSBlbHNlIGlmKGluZGV4ID09IHRoaXMubGVuZ3RoKCkgLSAyKSB7IC8vIGxhc3QgZWxlbWVudCBcbiAgICAgIHRoaXMubGFzdC5wcmV2Lm5leHQgPSBsZWZ0Tm9kZTtcbiAgICAgIGxlZnROb2RlLnByZXYgPSB0aGlzLmxhc3QucHJldjsgICAgICBcbiAgICAgIHRoaXMubGFzdCA9IHJpZ2h0Tm9kZTtcbiAgICB9IGVsc2UgeyAvLyBtaWRkbGUgY2FzZVxuICAgICAgbGV0IGN1cnIgOiBOb2RlID0gdGhpcy5nZXROb2RlKGluZGV4KTtcbiAgICAgIFxuICAgICAgY29uc3QgcHJldiA9IGN1cnIucHJldjtcbiAgICAgIGNvbnN0IG5leHQgPSBjdXJyLm5leHQ7XG4gICAgICBsZWZ0Tm9kZS5wcmV2ID0gcHJldjtcbiAgICAgIHJpZ2h0Tm9kZS5uZXh0ID0gbmV4dDtcblxuICAgICAgcHJldi5uZXh0ID0gbGVmdE5vZGU7ICAgICAgICBcbiAgICAgIG5leHQucHJldiA9IHJpZ2h0Tm9kZTtcbiAgICB9XG4gIH1cbn0iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCJwNS5kLnRzXCIgLz5cblxuaW1wb3J0IHtUZXJyYWluR2VuZXJhdG9yfSBmcm9tICcuL3RlcnJhaW4tZ2VuZXJhdG9yJztcbmltcG9ydCB7IFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdCB9IGZyb20gJy4vc2Nyb2xsaW5nLW1pZHBvaW50LWRpc3BsYWNlci1saW5rZWRsaXN0JztcblxuY29uc3Qgc2tldGNoID0gZnVuY3Rpb24gKHAgOiBwNSkge1xuICBjb25zdCBXIDogbnVtYmVyID0gNjAwO1xuICBjb25zdCBIIDogbnVtYmVyID0gNDAwO1xuICBjb25zdCBtZHAgOiBUZXJyYWluR2VuZXJhdG9yID0gbmV3IFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdCgxMCwgVywgSCk7XG5cbiAgcC5zZXR1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBwLmNyZWF0ZUNhbnZhcyhXLCBIKTtcblxuICAgIHAuYmFja2dyb3VuZChwLmNvbG9yKCd5ZWxsb3cnKSk7XG5cbiAgICBwLnN0cm9rZShwLmNvbG9yKCdyZWQnKSk7XG5cbiAgICBwLnN0cm9rZVdlaWdodCgyKTtcblxuICAgIHAuZnJhbWVSYXRlKDEwKTtcbiAgfTtcblxuICBwLmRyYXcgPSBmdW5jdGlvbigpIHtcbiAgICBwLmJhY2tncm91bmQocC5jb2xvcigneWVsbG93JykpO1xuICAgIG1kcC51cGRhdGUoKTsgXG4gICAgbWRwLnJlbmRlcihwKTtcbiAgfTtcbn07XG5cbi8vIFRPRE8oZnJlZWZvb2QpOiBmaXggZGF0YS5qc29uIHRvIGhhdmUgbW9yZSBleHBsaWNpdCB0eXBlIFxubmV3IHA1KHNrZXRjaCwgZmFsc2UsIGZhbHNlKTsiLCIvKipcbiAqIGNsYXNzIHRvIHJlcHJlc2VudCBwYWlyIG9mIFRzXG4gKlxuICovXG5cbmV4cG9ydCBjbGFzcyBQYWlyPFQ+IHtcbiAgICBwdWJsaWMgeCA6IFQ7XG4gICAgcHVibGljIHkgOiBUO1xuICAgIGNvbnN0cnVjdG9yKHg6IFQsIHk6IFQpIHtcbiAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgdGhpcy55ID0geTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBgUGFpcigke3RoaXMueH0sJHt0aGlzLnl9KWA7XG4gICAgfVxuICAgIFxuICAgIHB1YmxpYyBzaGFsbG93Q2xvbmUoKSA6IFBhaXI8VD4ge1xuICAgICAgICByZXR1cm4gbmV3IFBhaXIodGhpcy54LCB0aGlzLnkpO1xuICAgIH1cbn0iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCJwNS5kLnRzXCIgLz5cbi8qKlxuICogRGF0YSBTdHJ1Y3R1cmUgZm9yIHNldCBvZiBsaW5lIHNlZ21lbnRzIGdlbmVyYXRlZCB2aWEgbWlkcG9pbnQgZGlzcGxhY2VtZW50XG4gKi9cbmltcG9ydCB7UGFpcn0gZnJvbSAnLi9wYWlyJztcbmltcG9ydCB7IFNwbGl0dGFibGVMaW5lIH0gZnJvbSAnLi9zcGxpdHRhYmxlLWxpbmUnO1xuaW1wb3J0IHsgTGlua2VkTGlzdCB9IGZyb20gJy4vbGlua2VkLWxpc3QnO1xuXG5leHBvcnQgY2xhc3MgU2Nyb2xsaW5nTWlkcG9pbnREaXNwbGFjZXJMaW5rZWRMaXN0IHtcbiAgc3RhdGljIFJPVUdITkVTUyA6IG51bWJlciA9IC44O1xuXG4gIC8vIFRPRE8oYXV0b21hdHdvbik6IHRoaXMgaXMgcHJvYmFibHkgbW9yZSBlZmZpY2llbnRseSByZXByZXNlbnRlZCBhcyBzZXF1ZW5jZVxuICAvLyBvZiBwb2ludHMuIEJ1dCBlYXNpZXIgdG8gaW1wbGVtZW50IHdpdGggU3BsaXR0YWJsZUxpbmVzIGZvciBub3dcbiAgcHJpdmF0ZSBsaW5lU2VnbWVudHM6IExpbmtlZExpc3Q7XG5cbiAgcHJpdmF0ZSB3OiBudW1iZXI7XG4gIHByaXZhdGUgaDogbnVtYmVyO1xuICBwcml2YXRlIGJhc2VEaXNwbGFjZW1lbnQ6IG51bWJlcjtcbiAgcHJpdmF0ZSB2ZXJ0aWNhbEJvdW5kOiBQYWlyPG51bWJlcj47XG4gIHByaXZhdGUgaXRlcmF0aW9uczogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKGluaXRpYWxSZXNvbHV0aW9uOiBudW1iZXIsIHc6IG51bWJlciwgaDogbnVtYmVyKSB7XG4gICAgY29uc3QgbGluZXMgOiBMaW5rZWRMaXN0ID0gbmV3IExpbmtlZExpc3QoKTtcbiAgICB0aGlzLmxpbmVTZWdtZW50cyA9IGxpbmVzO1xuXG4gICAgY29uc3QgcDEgOiBQYWlyPG51bWJlcj49IG5ldyBQYWlyKDAsIDE1MCk7XG4gICAgY29uc3QgcDIgOiBQYWlyPG51bWJlcj49IG5ldyBQYWlyKHcvNCwgMjUwKTtcbiAgICBjb25zdCBiYXNlRGlzcGxhY2VtZW50ID0gcDEueSAtIHAyLnk7XG4gICAgY29uc3QgbCA6IFNwbGl0dGFibGVMaW5lID0gbmV3IFNwbGl0dGFibGVMaW5lKHAxLCBwMiwgMCwgIGJhc2VEaXNwbGFjZW1lbnQpO1xuICAgIGxpbmVzLnB1c2gobCk7XG5cbiAgICB0aGlzLncgPSB3O1xuICAgIHRoaXMuaCA9IGg7XG4gICAgdGhpcy52ZXJ0aWNhbEJvdW5kID0gbmV3IFBhaXI8bnVtYmVyPigwLCB0aGlzLmgpO1xuXG4gICAgZm9yKGxldCBpID0gMCA7IGkgPCAyMDsgaSsrKSB7XG4gICAgICB0aGlzLnByb3BhZ2F0ZSgpO1xuICAgIH1cblxuICAgIHRoaXMuaXRlcmF0aW9ucyA9IDA7XG4gIH1cblxuICBwdWJsaWMgcmVuZGVyKHA6IHA1KSB7XG4gICAgdGhpcy5saW5lU2VnbWVudHMuZm9yRWFjaCgobDogU3BsaXR0YWJsZUxpbmUpID0+IHtcbiAgICAgICBwLmxpbmUobC5hLngsIGwuYS55LCBsLmIueCwgbC5iLnkpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHByb3BhZ2F0ZSgpIHtcbiAgICBjb25zdCBsaW5lcyA9IHRoaXMubGluZVNlZ21lbnRzO1xuICAgIGxldCBpID0gdGhpcy5saW5lU2VnbWVudHMubGVuZ3RoKCkgLSAxOyAgICBcbiAgICB3aGlsZShpID49IDApIHtcbiAgICAgIGNvbnN0IGwgOiBTcGxpdHRhYmxlTGluZSA9IGxpbmVzLmdldChpKTtcbiAgICAgIC8vIFRPRE8oYXV0b21hdHdvbik6IGNvbnNpZGVyIGRyb3BwaW5nIHRoaXMgaWYgd2UgYXJlIHVzaW5nIHNldCBvZiBwb2ludHMsXG4gICAgICAvLyBpbnN0ZWFkIG9mIGxpbmUgc2VnbWVudHMsIHdoZXJlIHdlIGNhbiBjb21wYXJlIGFkamFjZW50IHBhaXJzXG4gICAgICBpZighU2Nyb2xsaW5nTWlkcG9pbnREaXNwbGFjZXJMaW5rZWRMaXN0LnNraXBTcGxpdHRhYmxlTGluZShsKSkge1xuICAgICAgICBjb25zdCBzcGxpdCA6IFBhaXI8U3BsaXR0YWJsZUxpbmU+ID0gbC5nZXRTcGxpdCh0aGlzLnZlcnRpY2FsQm91bmQpO1xuICAgICAgICBsaW5lcy5zcGxpdEF0KGksIHNwbGl0KTtcbiAgICAgIH1cbiAgIFxuICAgICAgaS0tO1xuICAgIH1cbiAgfVxuICBcbiAgcHVibGljIHVwZGF0ZSgpIHtcbiAgICB0aGlzLml0ZXJhdGlvbnMrKztcbiAgICAgIFxuICAgIC8vIERlcXVldWUgZWFybGllc3QgbGluZSBzZWdtZW50c1xuICAgIHRoaXMubGluZVNlZ21lbnRzLnBvcCgpO1xuICAgIHRoaXMucHJvcGFnYXRlKCk7XG5cbiAgICAvLyBFbnF1ZXVlIGxpbmVzXG4gICAgaWYodGhpcy5pdGVyYXRpb25zICUgNzAgPT0gMCkge1xuICAgICAgICBjb25zdCBsYXN0IDogU3BsaXR0YWJsZUxpbmUgPSB0aGlzLmxpbmVTZWdtZW50cy5wZWVrTGFzdCgpO1xuICAgICAgICBjb25zdCBiZWdpbkNvb3JkaW5hdGUgPSBsYXN0LmIuc2hhbGxvd0Nsb25lKCk7XG4gICAgICAgIGNvbnN0IGVuZENvb3JkaW5hdGUgPSBuZXcgUGFpcih0aGlzLncvNCooMSsodGhpcy5pdGVyYXRpb25zIC8gNzApKSwgTWF0aC5mbG9vcih0aGlzLmggKiBNYXRoLnJhbmRvbSgpKSk7XG4gICAgICAgIGNvbnN0IG5ld0xpbmUgPSBuZXcgU3BsaXR0YWJsZUxpbmUoYmVnaW5Db29yZGluYXRlLCBlbmRDb29yZGluYXRlLCAwLCBiZWdpbkNvb3JkaW5hdGUueSAtIGVuZENvb3JkaW5hdGUueSk7XG4gICAgICAgIHRoaXMubGluZVNlZ21lbnRzLnB1c2gobmV3TGluZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gQ29uZGl0aW9uIHRvIHN0b3AgbG9vcGluZ1xuICBzdGF0aWMgc2tpcFNwbGl0dGFibGVMaW5lKGwgOiBTcGxpdHRhYmxlTGluZSkgOiBib29sZWFuIHtcbiAgICByZXR1cm4gbC5iLnggLSBsLmEueCA8IDI7XG4gIH1cbn1cbiIsImltcG9ydCB7UGFpcn0gZnJvbSAnLi9wYWlyJztcblxuLyoqXG4gKiBjbGFzcyB0byByZXByZXNlbnQgTGluZSBzZWdtZW50IHdpdGggYWRkaXRpb25hbCBkYXRhIGZvciBtaWRwb2ludCBkaXNwbGFjZW1lbnQgc3BsaXR0aW5nXG4gKi9cblxuZXhwb3J0IGNsYXNzIFNwbGl0dGFibGVMaW5lIHtcbiAgc3RhdGljIFJPVUdITkVTUzogbnVtYmVyID0gLjY7XG4gIHB1YmxpYyBhOiBQYWlyPG51bWJlcj47XG4gIHB1YmxpYyBiOiBQYWlyPG51bWJlcj47XG4gIHByaXZhdGUgZ2VuZXJhdGlvbjogbnVtYmVyO1xuICBwcml2YXRlIGJhc2VEaXNwbGFjZW1lbnQ6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihhOiBQYWlyPG51bWJlcj4sIGI6IFBhaXI8bnVtYmVyPiwgZ2VuZXJhdGlvbjogbnVtYmVyLCBiYXNlRGlzcGxhY2VtZW50OiBudW1iZXIpIHtcbiAgICB0aGlzLmEgPSBhO1xuICAgIHRoaXMuYiA9IGI7XG4gICAgdGhpcy5nZW5lcmF0aW9uID0gZ2VuZXJhdGlvbjtcbiAgICB0aGlzLmJhc2VEaXNwbGFjZW1lbnQgPSBiYXNlRGlzcGxhY2VtZW50O1xuICB9XG5cbiAgcHVibGljIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiBgTGluZSgke3RoaXMuYS50b1N0cmluZygpfS0+JHt0aGlzLmIudG9TdHJpbmcoKX0pYDtcbiAgfVxuXG4gIHB1YmxpYyBnZXRNaWRwb2ludCgpIDogUGFpcjxudW1iZXI+IHtcbiAgICBjb25zdCB4ID0gKHRoaXMuYi54ICsgdGhpcy5hLngpIC8gMjtcbiAgICBjb25zdCB5ID0gKHRoaXMuYi55ICsgdGhpcy5hLnkpIC8gMjtcbiAgICByZXR1cm4gbmV3IFBhaXI8bnVtYmVyPih4LCB5KTtcbiAgfVxuXG4gIHB1YmxpYyBuZXh0RGlzcGxhY2VtZW50TWFnbml0dWRlKCkgOiBudW1iZXIge1xuICAgIGNvbnN0IGJhc2VEaXNwbGFjZW1lbnRTY2FsZSA9IDIgKiogKC0xKlNwbGl0dGFibGVMaW5lLlJPVUdITkVTUyk7XG4gICAgY29uc3QgZGlzcGxhY2VtZW50U2NhbGUgPSAgYmFzZURpc3BsYWNlbWVudFNjYWxlKip0aGlzLmdlbmVyYXRpb247XG4gICAgcmV0dXJuIHRoaXMuYmFzZURpc3BsYWNlbWVudCAqIGRpc3BsYWNlbWVudFNjYWxlO1xuICB9XG5cbiAgcHVibGljIGdldEdlbmVyYXRpb24oKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5nZW5lcmF0aW9uO1xuICB9XG5cbiAgcHVibGljIGdldEJhc2VEaXNwbGFjZW1lbnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5iYXNlRGlzcGxhY2VtZW50O1xuICB9XG5cbiAgcHVibGljIGdldFNwbGl0KHZlcnRpY2FsQm91bmQ6IFBhaXI8bnVtYmVyPik6IFBhaXI8U3BsaXR0YWJsZUxpbmU+IHtcbiAgICBjb25zdCBkaXNwbGFjZW1lbnRNYWduaXR1ZGUgPSB0aGlzLm5leHREaXNwbGFjZW1lbnRNYWduaXR1ZGUoKTtcbiAgICBjb25zdCBsZWZ0UG9pbnQgOiBQYWlyPG51bWJlcj4gPSB0aGlzLmE7XG4gICAgY29uc3QgcmlnaHRQb2ludCA6IFBhaXI8bnVtYmVyPj0gdGhpcy5iO1xuXG4gICAgLy8gQ29tcHV0ZSBkaXNwbGFjZWQgbWlkcG9pbnRcbiAgICBjb25zdCBtaWRwb2ludCA6IFBhaXI8bnVtYmVyPiA9IHRoaXMuZ2V0TWlkcG9pbnQoKTtcbiAgICBjb25zdCB2ZXJ0aWNhbGx5RGlzcGxhY2VkTWlkcG9pbnQgOiBQYWlyPG51bWJlcj4gPSB0aGlzLmRpc3BsYWNlUG9pbnRWZXJ0aWNhbGx5KFxuICAgICAgbWlkcG9pbnQsIGRpc3BsYWNlbWVudE1hZ25pdHVkZSwgdmVydGljYWxCb3VuZCk7XG5cbiAgICBjb25zdCBnZW5lcmF0aW9uID0gdGhpcy5nZXRHZW5lcmF0aW9uKCkgKyAxO1xuICAgIGNvbnN0IGJhc2VEaXNwbGFjZW1lbnQgPSB0aGlzLmdldEJhc2VEaXNwbGFjZW1lbnQoKTtcbiAgICBjb25zdCBsZWZ0U3BsaXR0YWJsZUxpbmUgOiBTcGxpdHRhYmxlTGluZSA9IG5ldyBTcGxpdHRhYmxlTGluZShsZWZ0UG9pbnQsIHZlcnRpY2FsbHlEaXNwbGFjZWRNaWRwb2ludCwgZ2VuZXJhdGlvbiwgYmFzZURpc3BsYWNlbWVudCk7XG4gICAgY29uc3QgcmlnaHRTcGxpdHRhYmxlTGluZSA6IFNwbGl0dGFibGVMaW5lID0gbmV3IFNwbGl0dGFibGVMaW5lKHZlcnRpY2FsbHlEaXNwbGFjZWRNaWRwb2ludCwgcmlnaHRQb2ludCwgZ2VuZXJhdGlvbiwgYmFzZURpc3BsYWNlbWVudCk7XG5cbiAgICByZXR1cm4gbmV3IFBhaXIobGVmdFNwbGl0dGFibGVMaW5lLCByaWdodFNwbGl0dGFibGVMaW5lKTtcbiAgfVxuXG4gICBwcml2YXRlIGRpc3BsYWNlUG9pbnRWZXJ0aWNhbGx5KHA6IFBhaXI8bnVtYmVyPiwgZGlzcGxhY2VNYWduaXR1ZGU6IG51bWJlciwgdmVydGljYWxCb3VuZDogUGFpcjxudW1iZXI+KSA6IFBhaXI8bnVtYmVyPntcbiAgICBsZXQgeSA9IHAueSArIHRoaXMuY2hvb3NlKFtkaXNwbGFjZU1hZ25pdHVkZSwgLWRpc3BsYWNlTWFnbml0dWRlXSk7XG4gICAgXG4gICAgLy8gQm91bmQgdGhlIHZhbHVlIHRvIHdpdGhpbiB3aW5kb3dcbiAgICB5ID0gdGhpcy5jbGFtcCh5LCB2ZXJ0aWNhbEJvdW5kLngsIHZlcnRpY2FsQm91bmQueSk7XG5cbiAgICByZXR1cm4gbmV3IFBhaXIocC54LCB5KTtcbiAgfVxuXG4gICAgLy8gUHJpdmF0ZSBzdGF0aWMgZmluYWw6IG1vdmUgaW50byB1dGlsaXR5IG9yIGdsb2JhbC5kLnRzXG4gIHByaXZhdGUgY2hvb3NlKGNob2ljZXM6IEFycmF5PGFueT4pIHtcbiAgICByZXR1cm4gY2hvaWNlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjaG9pY2VzLmxlbmd0aCldO1xuICB9XG5cbiAgcHJpdmF0ZSBjbGFtcCh4OiBudW1iZXIsIGxvd2VyQm91bmQ6IG51bWJlciwgdXBwZXJCb3VuZDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIE1hdGgubWluKHVwcGVyQm91bmQsIE1hdGgubWF4KHgsIGxvd2VyQm91bmQpKTtcbiAgfVxufSJdfQ==