(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var Node = (function () {
    function Node(data) {
        this.prev = null;
        this.next = null;
        this.data = data;
    }
    return Node;
}());
exports.Node = Node;
var LinkedList = (function () {
    function LinkedList() {
        this.first = null;
        this.last = null;
        this.length_ = 0;
    }
    LinkedList.prototype.length = function () {
        return this.length_;
    };
    LinkedList.prototype.get = function (index) {
        return this.getNode(index).data;
    };
    LinkedList.prototype.getNode = function (index) {
        var i = 0;
        var curr = this.first;
        while (curr != null) {
            if (i == index) {
                break;
            }
            curr = curr.next;
            i++;
        }
        if (i != index) {
            throw Error('Invalid index');
        }
        return curr;
    };
    LinkedList.prototype.pop = function () {
        if (!(this.first)) {
            throw new Error("Nothing to pop");
        }
        var node = this.first;
        if (node.next == null) {
            this.first = null;
        }
        else {
            this.first = node.next;
            this.first.prev = null;
        }
        this.length_--;
        return node.data;
    };
    LinkedList.prototype.push = function (e) {
        var n = new Node(e);
        if (this.last == null) {
            this.first = n;
            this.last = n;
        }
        else {
            this.last.next = n;
            n.prev = this.last;
            this.last = n;
        }
        this.length_++;
    };
    LinkedList.prototype.peekLast = function () {
        return this.last.data;
    };
    LinkedList.prototype.forEach = function (f) {
        var i = 0;
        var curr = this.first;
        while (curr != null) {
            f(curr.data);
            curr = curr.next;
            i++;
        }
    };
    LinkedList.prototype.splitAt = function (index, split) {
        if (index < 0) {
            throw Error();
        }
        if (this.first == null) {
            throw Error('Invalid index');
        }
        if (this.first.next == null && index != 0) {
            throw Error('Index DNE');
        }
        if (index >= this.length()) {
            throw Error('Index out bounds');
        }
        this.length_++;
        var leftNode = new Node(split.x);
        var rightNode = new Node(split.y);
        leftNode.next = rightNode;
        rightNode.prev = leftNode;
        if (this.first.next == null) {
            this.first = leftNode;
            this.last = rightNode;
        }
        else if (index == 0) {
            var next = this.first.next;
            rightNode.next = next;
            this.first = leftNode;
            next.prev = rightNode;
        }
        else if (index == this.length() - 2) {
            this.last.prev.next = leftNode;
            leftNode.prev = this.last.prev;
            this.last = rightNode;
        }
        else {
            var curr = this.getNode(index);
            var prev = curr.prev;
            var next = curr.next;
            leftNode.prev = prev;
            rightNode.next = next;
            prev.next = leftNode;
            next.prev = rightNode;
        }
    };
    return LinkedList;
}());
exports.LinkedList = LinkedList;

},{}],2:[function(require,module,exports){
"use strict";
var scrolling_midpoint_displacer_linkedlist_1 = require("./scrolling-midpoint-displacer-linkedlist");
var sketch = function (p) {
    var MARGIN_PERCENTAGE = .15;
    var W = 2000;
    var H = 400;
    var minimumW = 640;
    var maximumH = Math.round(H * (1 - MARGIN_PERCENTAGE));
    var mdp = new scrolling_midpoint_displacer_linkedlist_1.ScrollingMidpointDisplacerLinkedList(minimumW, maximumH);
    p.setup = function () {
        p.createCanvas(W, H);
        p.strokeWeight(2);
        p.frameRate(20);
    };
    p.draw = function () {
        p.background(p.color('black'));
        p.push();
        p.translate(0, MARGIN_PERCENTAGE * H / 2);
        p.stroke(p.color(98, 203, 157));
        mdp.update();
        mdp.render(p);
        p.pop();
        p.stroke(p.color('white'));
        p.line(minimumW, 0, minimumW, H);
    };
};
new p5(sketch, false, false);

},{"./scrolling-midpoint-displacer-linkedlist":4}],3:[function(require,module,exports){
"use strict";
var Pair = (function () {
    function Pair(x, y) {
        this.x = x;
        this.y = y;
    }
    Pair.prototype.toString = function () {
        return "Pair(" + this.x + "," + this.y + ")";
    };
    Pair.prototype.shallowClone = function () {
        return new Pair(this.x, this.y);
    };
    return Pair;
}());
exports.Pair = Pair;

},{}],4:[function(require,module,exports){
"use strict";
var pair_1 = require("./pair");
var splittable_line_1 = require("./splittable-line");
var linked_list_1 = require("./linked-list");
var ScrollingMidpointDisplacerLinkedList = (function () {
    function ScrollingMidpointDisplacerLinkedList(minimumWidth, maximumHeight) {
        this.verticalBound = new pair_1.Pair(0, maximumHeight);
        var lines = new linked_list_1.LinkedList();
        this.lineSegments = lines;
        var p1 = new pair_1.Pair(0, 150);
        var p2 = new pair_1.Pair(ScrollingMidpointDisplacerLinkedList.INITIAL_LINE_WIDTH, 250);
        var baseDisplacement = p1.y - p2.y;
        var l = new splittable_line_1.SplittableLine(p1, p2, 0, baseDisplacement);
        lines.push(l);
        var numBaseLineSegments = minimumWidth / ScrollingMidpointDisplacerLinkedList.INITIAL_LINE_WIDTH;
        for (var i = 0; i < numBaseLineSegments; i++) {
            this.enqueue();
        }
        this.enqueueInterval = Math.pow(ScrollingMidpointDisplacerLinkedList.POWER, (ScrollingMidpointDisplacerLinkedList.MAX_GENERATIONS - 1));
        for (var i = 0; i < ScrollingMidpointDisplacerLinkedList.MAX_GENERATIONS; i++) {
            this.displace();
        }
        this.iterations = 0;
    }
    ScrollingMidpointDisplacerLinkedList.prototype.render = function (p) {
        this.lineSegments.forEach(function (l) {
            p.line(l.a.x, l.a.y, l.b.x, l.b.y);
        });
    };
    ScrollingMidpointDisplacerLinkedList.prototype.enqueue = function () {
        var last = this.lineSegments.peekLast();
        var beginCoordinate = new pair_1.Pair(last.b.x + 0, last.b.y + 0);
        var endCoordinate = new pair_1.Pair(beginCoordinate.x +
            ScrollingMidpointDisplacerLinkedList.INITIAL_LINE_WIDTH, Math.floor(this.verticalBound.y * Math.random()));
        var newLine = new splittable_line_1.SplittableLine(beginCoordinate, endCoordinate, 0, beginCoordinate.y - endCoordinate.y);
        this.lineSegments.push(newLine);
    };
    ScrollingMidpointDisplacerLinkedList.prototype.displace = function () {
        var lines = this.lineSegments;
        var i = this.lineSegments.length() - 1;
        while (i >= 0) {
            var l = lines.get(i);
            if (!ScrollingMidpointDisplacerLinkedList.skipSplittableLine(l)) {
                var split = l.getSplit(this.verticalBound);
                lines.splitAt(i, split);
            }
            i--;
        }
    };
    ScrollingMidpointDisplacerLinkedList.prototype.scroll = function () {
        var deltaX = ScrollingMidpointDisplacerLinkedList.MINIMUM_LINE_WIDTH;
        this.lineSegments.forEach(function (l) {
            l.translate(-1 * deltaX, 0);
        });
    };
    ScrollingMidpointDisplacerLinkedList.prototype.update = function () {
        this.iterations++;
        this.lineSegments.pop();
        this.displace();
        if (this.iterations % this.enqueueInterval == 0) {
            this.enqueue();
        }
        this.scroll();
    };
    ScrollingMidpointDisplacerLinkedList.skipSplittableLine = function (l) {
        return l.getGeneration() >= ScrollingMidpointDisplacerLinkedList.MAX_GENERATIONS - 1;
    };
    return ScrollingMidpointDisplacerLinkedList;
}());
ScrollingMidpointDisplacerLinkedList.ROUGHNESS = .8;
ScrollingMidpointDisplacerLinkedList.POWER = 2;
ScrollingMidpointDisplacerLinkedList.MINIMUM_LINE_WIDTH = 2;
ScrollingMidpointDisplacerLinkedList.MAX_GENERATIONS = 7;
ScrollingMidpointDisplacerLinkedList.INITIAL_LINE_WIDTH = (ScrollingMidpointDisplacerLinkedList.MINIMUM_LINE_WIDTH *
    Math.pow(ScrollingMidpointDisplacerLinkedList.POWER, (ScrollingMidpointDisplacerLinkedList.MAX_GENERATIONS - 1)));
exports.ScrollingMidpointDisplacerLinkedList = ScrollingMidpointDisplacerLinkedList;

},{"./linked-list":1,"./pair":3,"./splittable-line":5}],5:[function(require,module,exports){
"use strict";
var pair_1 = require("./pair");
var SplittableLine = (function () {
    function SplittableLine(a, b, generation, baseDisplacement) {
        this.a = a;
        this.b = b;
        this.generation = generation;
        this.baseDisplacement = baseDisplacement;
    }
    SplittableLine.prototype.toString = function () {
        return "Line(" + this.a.toString() + "->" + this.b.toString() + ")";
    };
    SplittableLine.prototype.getMidpoint = function () {
        var x = (this.b.x + this.a.x) / 2;
        var y = (this.b.y + this.a.y) / 2;
        return new pair_1.Pair(x, y);
    };
    SplittableLine.prototype.nextDisplacementMagnitude = function () {
        var baseDisplacementScale = Math.pow(2, (-1 * SplittableLine.ROUGHNESS));
        var displacementScale = Math.pow(baseDisplacementScale, this.generation);
        return this.baseDisplacement * displacementScale;
    };
    SplittableLine.prototype.getGeneration = function () {
        return this.generation;
    };
    SplittableLine.prototype.getBaseDisplacement = function () {
        return this.baseDisplacement;
    };
    SplittableLine.prototype.getSplit = function (verticalBound) {
        var displacementMagnitude = this.nextDisplacementMagnitude();
        var leftPoint = this.a;
        var rightPoint = this.b;
        var midpoint = this.getMidpoint();
        var verticallyDisplacedMidpointA = this.displacePointVertically(midpoint, displacementMagnitude, verticalBound);
        var verticallyDisplacedMidpointB = verticallyDisplacedMidpointA.shallowClone();
        var generation = this.getGeneration() + 1;
        var baseDisplacement = this.getBaseDisplacement();
        var leftSplittableLine = new SplittableLine(leftPoint, verticallyDisplacedMidpointA, generation, baseDisplacement);
        var rightSplittableLine = new SplittableLine(verticallyDisplacedMidpointB, rightPoint, generation, baseDisplacement);
        return new pair_1.Pair(leftSplittableLine, rightSplittableLine);
    };
    SplittableLine.prototype.displacePointVertically = function (p, displaceMagnitude, verticalBound) {
        var y = p.y + this.choose([displaceMagnitude, -displaceMagnitude]);
        y = this.clamp(y, verticalBound.x, verticalBound.y);
        return new pair_1.Pair(p.x, y);
    };
    SplittableLine.prototype.choose = function (choices) {
        return choices[Math.floor(Math.random() * choices.length)];
    };
    SplittableLine.prototype.clamp = function (x, lowerBound, upperBound) {
        return Math.min(upperBound, Math.max(x, lowerBound));
    };
    SplittableLine.prototype.translate = function (x, y) {
        this.a.x += x;
        this.a.y += y;
        this.b.x += x;
        this.b.y += y;
    };
    return SplittableLine;
}());
SplittableLine.ROUGHNESS = .6;
exports.SplittableLine = SplittableLine;

},{"./pair":3}]},{},[2])

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbGlua2VkLWxpc3QudHMiLCJzcmMvbWFpbi50cyIsInNyYy9wYWlyLnRzIiwic3JjL3Njcm9sbGluZy1taWRwb2ludC1kaXNwbGFjZXItbGlua2VkbGlzdC50cyIsInNyYy9zcGxpdHRhYmxlLWxpbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDTUE7SUFLRSxjQUFZLElBQVM7UUFDbkIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbkIsQ0FBQztJQUNILFdBQUM7QUFBRCxDQVZBLEFBVUMsSUFBQTtBQVZZLG9CQUFJO0FBWWpCO0lBS0U7UUFDRSxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztJQUNuQixDQUFDO0lBRUQsMkJBQU0sR0FBTjtRQUNFLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3RCLENBQUM7SUFFRCx3QkFBRyxHQUFILFVBQUksS0FBYTtRQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNsQyxDQUFDO0lBR08sNEJBQU8sR0FBZixVQUFnQixLQUFhO1FBQzNCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNWLElBQUksSUFBSSxHQUFVLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDN0IsT0FBTSxJQUFJLElBQUksSUFBSSxFQUFFLENBQUM7WUFDbkIsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ2QsS0FBSyxDQUFDO1lBQ1IsQ0FBQztZQUNE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RUFBRSxVQUFrQixFQUFFLFVBQWtCO1FBQzdELE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFTSxrQ0FBUyxHQUFoQixVQUFpQixDQUFTLEVBQUUsQ0FBUztRQUNuQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDZCxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDZCxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDZCxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEIsQ0FBQztJQUNILHFCQUFDO0FBQUQsQ0FqRkEsQUFpRkM7QUFoRlEsd0JBQVMsR0FBVyxFQUFFLENBQUM7QUFEbkIsd0NBQWMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqXG4gKiBEb3VibHkgTGlua2VkIExpc3QgRGF0YSBzdHJ1Y3R1cmVcbiAqL1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL2xpbmUnO1xuaW1wb3J0IHtQYWlyfSBmcm9tICcuL3BhaXInO1xuXG5leHBvcnQgY2xhc3MgTm9kZSB7XG4gIHB1YmxpYyBkYXRhOiBhbnk7XG4gIHB1YmxpYyBwcmV2OiBOb2RlO1xuICBwdWJsaWMgbmV4dDogTm9kZTtcblxuICBjb25zdHJ1Y3RvcihkYXRhOiBhbnkpIHtcbiAgICB0aGlzLnByZXYgPSBudWxsO1xuICAgIHRoaXMubmV4dCA9IG51bGw7XG4gICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTGlua2VkTGlzdCB7XG4gIHByaXZhdGUgZmlyc3Q6IE5vZGU7XG4gIHByaXZhdGUgbGFzdDogTm9kZTtcbiAgcHJpdmF0ZSBsZW5ndGhfOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5maXJzdCA9IG51bGw7XG4gICAgdGhpcy5sYXN0ID0gbnVsbDtcbiAgICB0aGlzLmxlbmd0aF8gPSAwO1xuICB9XG5cbiAgbGVuZ3RoKCkgOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmxlbmd0aF87XG4gIH1cblxuICBnZXQoaW5kZXg6IG51bWJlcikgOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmdldE5vZGUoaW5kZXgpLmRhdGE7XG4gIH1cblxuICAvLyBUT0RPKGF1dG9tYXR3b24pOiBMb29wIGJhY2t3YXJkIGZyb20gZW5kIGlmIGNsb3NlciB0byBpbmRleC5cbiAgcHJpdmF0ZSBnZXROb2RlKGluZGV4OiBudW1iZXIpIDogTm9kZSB7XG4gICAgbGV0IGkgPSAwO1xuICAgIGxldCBjdXJyIDogTm9kZSA9IHRoaXMuZmlyc3Q7XG4gICAgd2hpbGUoY3VyciAhPSBudWxsKSB7XG4gICAgICBpZihpID09IGluZGV4KSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY3VyciA9IGN1cnIubmV4dDtcbiAgICAgIGkrKztcbiAgICB9XG5cbiAgICBpZihpICE9IGluZGV4KSB7XG4gICAgICB0aHJvdyBFcnJvcignSW52YWxpZCBpbmRleCcpO1xuICAgIH1cbiAgICByZXR1cm4gY3VycjtcbiAgfVxuXG4gIC8vIFRocm93cyBudWxsIHBvaW50ZXIgaWYgbm8gZWxlbWVudCB0byBwb3BcbiAgcG9wKCkgOiBMaW5lIHtcbiAgICBpZighKHRoaXMuZmlyc3QpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3RoaW5nIHRvIHBvcFwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBub2RlID0gdGhpcy5maXJzdDtcbiAgICBpZihub2RlLm5leHQgPT0gbnVsbCkge1xuICAgICAgdGhpcy5maXJzdCA9IG51bGxcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5maXJzdCA9IG5vZGUubmV4dDtcbiAgICAgIHRoaXMuZmlyc3QucHJldiA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMubGVuZ3RoXy0tO1xuICAgIHJldHVybiBub2RlLmRhdGE7XG4gIH1cblxuICAvLyBiZSBzdHJpY3RlciBhYm91dCB0aGUgdHlwZSB0byBlOiBMaW5lYFxuICBwdXNoKGU6IGFueSkge1xuICAgIGNvbnN0IG4gPSBuZXcgTm9kZShlKTtcbiAgICBpZih0aGlzLmxhc3QgPT0gbnVsbCkge1xuICAgICAgdGhpcy5maXJzdCA9IG47XG4gICAgICB0aGlzLmxhc3QgPSBuO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxhc3QubmV4dCA9IG47XG4gICAgICBuLnByZXYgPSB0aGlzLmxhc3Q7XG4gICAgICB0aGlzLmxhc3QgPSBuO1xuICAgIH1cblxuICAgIHRoaXMubGVuZ3RoXysrO1xuICB9XG5cbiAgLy8gVE9ETyhhdXRvbWF0d29uKTogYWRkIHBlZWtGaXJzdFxuXG4gIHBlZWtMYXN0KCkgOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmxhc3QuZGF0YTtcbiAgfVxuXG4gIGZvckVhY2goZjogRnVuY3Rpb24pIDogdm9pZCB7XG4gICAgbGV0IGkgPSAwO1xuICAgIGxldCBjdXJyIDogTm9kZSA9IHRoaXMuZmlyc3Q7XG4gICAgd2hpbGUoY3VyciAhPSBudWxsKSB7XG4gICAgICBmKGN1cnIuZGF0YSk7XG4gICAgICBjdXJyID0gY3Vyci5uZXh0O1xuICAgICAgaSsrO1xuICAgIH1cbiAgfVxuXG4gIHNwbGl0QXQoaW5kZXg6IG51bWJlciwgIHNwbGl0OiBQYWlyPExpbmU+KSB7XG4gICAgLy8gVE9ETyhhdXRvbWF0d29uKTogRGlzYWJsZSB0aGVzZSBkZWZlbnNpdmUgY2hlY2tzIGZvciBwZXJmb3JtYW5jZVxuICAgIGlmKGluZGV4IDwgMCkge1xuICAgICAgdGhyb3cgRXJyb3IoKTtcbiAgICB9XG4gICAgaWYodGhpcy5maXJzdCA9PSBudWxsKSB7XG4gICAgICB0aHJvdyBFcnJvcignSW52YWxpZCBpbmRleCcpO1xuICAgIH1cbiAgICBpZih0aGlzLmZpcnN0Lm5leHQgPT0gbnVsbCAmJiBpbmRleCAhPSAwKSB7XG4gICAgICB0aHJvdyBFcnJvcignSW5kZXggRE5FJyk7XG4gICAgfVxuICAgIGlmKGluZGV4ID49IHRoaXMubGVuZ3RoKCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdJbmRleCBvdXQgYm91bmRzJyk7XG4gICAgfVxuICAgIFxuICAgIC8vIFJlcGxhY2Ugb25lIGVsZW1lbnQgd2l0aCB0d29cbiAgICB0aGlzLmxlbmd0aF8rKztcblxuICAgIC8vIExpbmsgdGhlIGVsZW1lbnRzXG4gICAgY29uc3QgbGVmdE5vZGUgPSBuZXcgTm9kZShzcGxpdC54KTtcbiAgICBjb25zdCByaWdodE5vZGUgPSBuZXcgTm9kZShzcGxpdC55KTtcbiAgICBsZWZ0Tm9kZS5uZXh0ID0gcmlnaHROb2RlO1xuICAgIHJpZ2h0Tm9kZS5wcmV2ID0gbGVmdE5vZGU7XG5cbiAgICBpZih0aGlzLmZpcnN0Lm5leHQgPT0gbnVsbCkgeyAvLyAxIGVsZW1lbnRcbiAgICAgIHRoaXMuZmlyc3QgPSBsZWZ0Tm9kZTtcbiAgICAgIHRoaXMubGFzdCA9IHJpZ2h0Tm9kZTtcbiAgICB9IGVsc2UgaWYoaW5kZXggPT0gMCkgeyAvLyBGaXJzdCBFbGVtZW50XG4gICAgICBjb25zdCBuZXh0ID0gdGhpcy5maXJzdC5uZXh0XG4gICAgICByaWdodE5vZGUubmV4dCA9IG5leHQ7XG4gICAgICB0aGlzLmZpcnN0ID0gbGVmdE5vZGU7XG4gICAgICBuZXh0LnByZXYgPSByaWdodE5vZGU7XG4gICAgfSBlbHNlIGlmKGluZGV4ID09IHRoaXMubGVuZ3RoKCkgLSAyKSB7IC8vIGxhc3QgZWxlbWVudCBcbiAgICAgIHRoaXMubGFzdC5wcmV2Lm5leHQgPSBsZWZ0Tm9kZTtcbiAgICAgIGxlZnROb2RlLnByZXYgPSB0aGlzLmxhc3QucHJldjsgICAgICBcbiAgICAgIHRoaXMubGFzdCA9IHJpZ2h0Tm9kZTtcbiAgICB9IGVsc2UgeyAvLyBtaWRkbGUgY2FzZVxuICAgICAgbGV0IGN1cnIgOiBOb2RlID0gdGhpcy5nZXROb2RlKGluZGV4KTtcbiAgICAgIFxuICAgICAgY29uc3QgcHJldiA9IGN1cnIucHJldjtcbiAgICAgIGNvbnN0IG5leHQgPSBjdXJyLm5leHQ7XG4gICAgICBsZWZ0Tm9kZS5wcmV2ID0gcHJldjtcbiAgICAgIHJpZ2h0Tm9kZS5uZXh0ID0gbmV4dDtcblxuICAgICAgcHJldi5uZXh0ID0gbGVmdE5vZGU7ICAgICAgICBcbiAgICAgIG5leHQucHJldiA9IHJpZ2h0Tm9kZTtcbiAgICB9XG4gIH1cbn0iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCJwNS5kLnRzXCIgLz5cblxuaW1wb3J0IHtUZXJyYWluR2VuZXJhdG9yfSBmcm9tICcuL3RlcnJhaW4tZ2VuZXJhdG9yJztcbmltcG9ydCB7IFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdCB9IGZyb20gJy4vc2Nyb2xsaW5nLW1pZHBvaW50LWRpc3BsYWNlci1saW5rZWRsaXN0JztcblxuY29uc3Qgc2tldGNoID0gZnVuY3Rpb24gKHAgOiBwNSkge1xuICBjb25zdCBNQVJHSU5fUEVSQ0VOVEFHRSA6IG51bWJlciA9IC4xNTtcbiAgXG4gIGNvbnN0IFcgOiBudW1iZXIgPSAyMDAwO1xuICBjb25zdCBIIDogbnVtYmVyID0gNDAwO1xuXG4gIGNvbnN0IG1pbmltdW1XOiBudW1iZXIgPSA2NDA7XG4gIGNvbnN0IG1heGltdW1IOiBudW1iZXIgPSBNYXRoLnJvdW5kKEggKigxIC0gTUFSR0lOX1BFUkNFTlRBR0UpKTtcblxuICBjb25zdCBtZHAgOiBUZXJyYWluR2VuZXJhdG9yID0gbmV3IFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdChtaW5pbXVtVywgbWF4aW11bUgpO1xuXG4gIHAuc2V0dXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgcC5jcmVhdGVDYW52YXMoVywgSCk7XG4gICAgcC5zdHJva2VXZWlnaHQoMik7XG4gICAgcC5mcmFtZVJhdGUoMjApO1xuICAgIFxuICB9O1xuXG4gIHAuZHJhdyA9IGZ1bmN0aW9uKCkge1xuICAgIHAuYmFja2dyb3VuZChwLmNvbG9yKCdibGFjaycpKTtcbiAgICBcbiAgICBwLnB1c2goKTtcbiAgICBwLnRyYW5zbGF0ZSgwLCBNQVJHSU5fUEVSQ0VOVEFHRSAqIEggLyAyKTtcbiAgICBwLnN0cm9rZShwLmNvbG9yKDk4LCAyMDMsIDE1NykpO1xuICAgIG1kcC51cGRhdGUoKTsgXG4gICAgbWRwLnJlbmRlcihwKTtcbiAgICBwLnBvcCgpO1xuXG4gICAgcC5zdHJva2UocC5jb2xvcignd2hpdGUnKSk7XG4gICAgcC5saW5lKG1pbmltdW1XLCAwLCBtaW5pbXVtVywgSCk7XG4gIH07XG59O1xuXG4vLyBUT0RPKGZyZWVmb29kKTogZml4IGRhdGEuanNvbiB0byBoYXZlIG1vcmUgZXhwbGljaXQgdHlwZSBcbm5ldyBwNShza2V0Y2gsIGZhbHNlLCBmYWxzZSk7IiwiLyoqXG4gKiBjbGFzcyB0byByZXByZXNlbnQgcGFpciBvZiBUc1xuICpcbiAqL1xuXG5leHBvcnQgY2xhc3MgUGFpcjxUPiB7XG4gICAgLy8gVE9PRChhdXRvbWF0d29uKTogY2hhbmdlIHgsIHkgLT4gXy4xLCBfLjJcbiAgICBwdWJsaWMgeCA6IFQ7XG4gICAgcHVibGljIHkgOiBUO1xuXG4gICAgY29uc3RydWN0b3IoeDogVCwgeTogVCkge1xuICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICB0aGlzLnkgPSB5O1xuICAgIH1cblxuICAgIHB1YmxpYyB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIGBQYWlyKCR7dGhpcy54fSwke3RoaXMueX0pYDtcbiAgICB9XG4gICAgXG4gICAgcHVibGljIHNoYWxsb3dDbG9uZSgpIDogUGFpcjxUPiB7XG4gICAgICAgIHJldHVybiBuZXcgUGFpcih0aGlzLngsIHRoaXMueSk7XG4gICAgfVxufSIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cInA1LmQudHNcIiAvPlxuLyoqXG4gKiBDbGFzcyB0byBtYW5hZ2Ugc3RhdGUgb2Ygc2Nyb2xsaW5nIHRlcnJhaW4gd2l0aCBkb3VibHktbGlua2VkIGxpc3QgcXVldWUgdGhhdCBwcm9ncmVzc2l2ZWx5IGJ1ZmZlcnMgbW9yZSBcbiAqIGxpbmVzIFxuXG4gKi9cblxuaW1wb3J0IHtQYWlyfSBmcm9tICcuL3BhaXInO1xuaW1wb3J0IHtTcGxpdHRhYmxlTGluZX0gZnJvbSAnLi9zcGxpdHRhYmxlLWxpbmUnO1xuaW1wb3J0IHtMaW5rZWRMaXN0fSBmcm9tICcuL2xpbmtlZC1saXN0JztcblxuZXhwb3J0IGNsYXNzIFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdCB7XG4gIHN0YXRpYyBST1VHSE5FU1MgOiBudW1iZXIgPSAuODtcblxuICAvLyBUT0RPKGF1dG9tYXR3b24pOiB0aGlzIGlzIHByb2JhYmx5IG1vcmUgZWZmaWNpZW50bHkgcmVwcmVzZW50ZWQgYXMgc2VxdWVuY2VcbiAgLy8gb2YgcG9pbnRzLiBCdXQgZWFzaWVyIHRvIGltcGxlbWVudCB3aXRoIFNwbGl0dGFibGVMaW5lcyBmb3Igbm93XG4gIHByaXZhdGUgbGluZVNlZ21lbnRzOiBMaW5rZWRMaXN0O1xuICBwcml2YXRlIGJhc2VEaXNwbGFjZW1lbnQ6IG51bWJlcjtcbiAgcHJpdmF0ZSB2ZXJ0aWNhbEJvdW5kOiBQYWlyPG51bWJlcj47XG5cbiAgcHJpdmF0ZSBpdGVyYXRpb25zOiBudW1iZXI7XG4gIHByaXZhdGUgZW5xdWV1ZUludGVydmFsOiBudW1iZXI7XG5cbiAgLy8gTnVtYmVyIG9mIHBhcnRzIHdlIHBhcnRpdGlvbiBlYWNoIGxpbmUgaW50b1xuICBzdGF0aWMgUE9XRVI6IG51bWJlciA9IDI7XG4gIHN0YXRpYyBNSU5JTVVNX0xJTkVfV0lEVEg6IG51bWJlciA9IDI7XG4gIHN0YXRpYyBNQVhfR0VORVJBVElPTlM6IG51bWJlciA9IDc7XG4gIHN0YXRpYyBJTklUSUFMX0xJTkVfV0lEVEg6IG51bWJlciA9IChcbiAgICBTY3JvbGxpbmdNaWRwb2ludERpc3BsYWNlckxpbmtlZExpc3QuTUlOSU1VTV9MSU5FX1dJRFRIICpcbiAgICAgIFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdC5QT1dFUiAqKlxuICAgIChTY3JvbGxpbmdNaWRwb2ludERpc3BsYWNlckxpbmtlZExpc3QuTUFYX0dFTkVSQVRJT05TLTEpXG4gICk7XG5cbiAgY29uc3RydWN0b3IobWluaW11bVdpZHRoOiBudW1iZXIsIG1heGltdW1IZWlnaHQ6IG51bWJlcikge1xuICAgIHRoaXMudmVydGljYWxCb3VuZCA9IG5ldyBQYWlyKDAsIG1heGltdW1IZWlnaHQpO1xuXG4gICAgY29uc3QgbGluZXMgOiBMaW5rZWRMaXN0ID0gbmV3IExpbmtlZExpc3QoKTtcbiAgICB0aGlzLmxpbmVTZWdtZW50cyA9IGxpbmVzO1xuXG4gICAgY29uc3QgcDEgOiBQYWlyPG51bWJlcj49IG5ldyBQYWlyKDAsIDE1MCk7XG4gICAgY29uc3QgcDIgOiBQYWlyPG51bWJlcj49IG5ldyBQYWlyKFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdC5JTklUSUFMX0xJTkVfV0lEVEgsIDI1MCk7XG4gICAgY29uc3QgYmFzZURpc3BsYWNlbWVudCA9IHAxLnkgLSBwMi55O1xuICAgIGNvbnN0IGwgOiBTcGxpdHRhYmxlTGluZSA9IG5ldyBTcGxpdHRhYmxlTGluZShwMSwgcDIsIDAsICBiYXNlRGlzcGxhY2VtZW50KTtcbiAgICBsaW5lcy5wdXNoKGwpO1xuXG4gICAgLy8gQWRkIGVub3VnaCBpbml0aWFsIGxpbmUgc2VnbWVudHMgc28gdGhlcmUgaXMgYWx3YXlzIGVub3VnaCBjb21wbGV0ZWx5IHNwbGl0IGxpbmUgc2VnbWVudHMgaW4gdmlld2FibGUgYXJlYVxuICAgIGNvbnN0IG51bUJhc2VMaW5lU2VnbWVudHMgPSBtaW5pbXVtV2lkdGggLyBTY3JvbGxpbmdNaWRwb2ludERpc3BsYWNlckxpbmtlZExpc3QuSU5JVElBTF9MSU5FX1dJRFRIO1xuICAgIGZvcihsZXQgaSA9IDA7IGkgPCBudW1CYXNlTGluZVNlZ21lbnRzOyBpKyspIHtcbiAgICAgIHRoaXMuZW5xdWV1ZSgpO1xuICAgIH1cbiAgICBcbiAgICAvLyBOdW1iZXIgb2YgaXRlcnRpb25zIGJlZm9yZSBlbnF1ZXVlXG4gICAgdGhpcy5lbnF1ZXVlSW50ZXJ2YWwgPSBTY3JvbGxpbmdNaWRwb2ludERpc3BsYWNlckxpbmtlZExpc3QuUE9XRVIgKiogKFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdC5NQVhfR0VORVJBVElPTlMgLSAxKTtcblxuICAgIC8vIEVuc3VyZSBhbGwgbGluZSBzZWdtZW50cyBvcmlnaW5hbGx5IGRpc3BsYWNlZCAvIHNwbGl0IGFzIG11Y2ggYXMgcG9zc2libGVcbiAgICBmb3IobGV0IGkgPSAwIDsgaSA8IFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdC5NQVhfR0VORVJBVElPTlM7IGkrKykge1xuICAgICAgdGhpcy5kaXNwbGFjZSgpO1xuICAgIH1cblxuICAgIHRoaXMuaXRlcmF0aW9ucyA9IDA7XG4gIH1cblxuICBwdWJsaWMgcmVuZGVyKHA6IHA1KSB7XG4gICAgdGhpcy5saW5lU2VnbWVudHMuZm9yRWFjaCgobDogU3BsaXR0YWJsZUxpbmUpID0+IHtcbiAgICAgICBwLmxpbmUobC5hLngsIGwuYS55LCBsLmIueCwgbC5iLnkpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQWRkIGEgdW5kaXNwbGFjZWQgbGluZSBzZWdtZW50IHRoYXQgc3RhcnRzIGZyb20gcHJldmlvdXMgbGluZSBzZWdtZW50XG4gIHB1YmxpYyBlbnF1ZXVlKCkge1xuICAgIGNvbnN0IGxhc3QgOiBTcGxpdHRhYmxlTGluZSA9IHRoaXMubGluZVNlZ21lbnRzLnBlZWtMYXN0KCk7XG4gICAgY29uc3QgYmVnaW5Db29yZGluYXRlID0gbmV3IFBhaXIobGFzdC5iLnggKyAwLCBsYXN0LmIueSArIDApOyBcbiAgICBjb25zdCBlbmRDb29yZGluYXRlID0gbmV3IFBhaXIoYmVnaW5Db29yZGluYXRlLnggK1xuICAgICAgU2Nyb2xsaW5nTWlkcG9pbnREaXNwbGFjZXJMaW5rZWRMaXN0LklOSVRJQUxfTElORV9XSURUSCwgTWF0aC5mbG9vcih0aGlzLnZlcnRpY2FsQm91bmQueSAqIE1hdGgucmFuZG9tKCkpKTtcbiAgICBjb25zdCBuZXdMaW5lID0gbmV3IFNwbGl0dGFibGVMaW5lKGJlZ2luQ29vcmRpbmF0ZSwgZW5kQ29vcmRpbmF0ZSwgMCwgYmVnaW5Db29yZGluYXRlLnkgLSBlbmRDb29yZGluYXRlLnkpO1xuICAgIHRoaXMubGluZVNlZ21lbnRzLnB1c2gobmV3TGluZSk7XG4gIH1cblxuICAvLyBQZXJmb3JtIGEgc2luZ2xlIHBhc3Mgb2YgbWlkcG9pbnQgZGlzcGxhY2VtZW50IG92ZXIgZXZlcnkgbGluZSBzZWdtZW50XG4gIHB1YmxpYyBkaXNwbGFjZSgpIHtcbiAgICBjb25zdCBsaW5lcyA9IHRoaXMubGluZVNlZ21lbnRzO1xuICAgIGxldCBpID0gdGhpcy5saW5lU2VnbWVudHMubGVuZ3RoKCkgLSAxO1xuICAgIHdoaWxlKGkgPj0gMCkge1xuICAgICAgLy8gVE9ETyhhdXRvbWF0d29uKTogaW5zdGVhZCBvZiB1c2luZyBnZXQuIGxvb3Agb3ZlciB0aGUgbGlzdCBpbiBhIHNpbmdsZSBwYXNzLiBhZGQgYSBpdGVyYXRvciB0byBkb3VibHkgTGlua2VkTGlzdFxuICAgICAgY29uc3QgbCA6IFNwbGl0dGFibGVMaW5lID0gbGluZXMuZ2V0KGkpO1xuICAgICAgLy8gVE9ETyhhdXRvbWF0d29uKTogY29uc2lkZXIgZHJvcHBpbmcgdGhpcyBpZiB3ZSBhcmUgdXNpbmcgc2V0IG9mIHBvaW50cyxcbiAgICAgIC8vIGluc3RlYWQgb2YgbGluZSBzZWdtZW50cywgd2hlcmUgd2UgY2FuIGNvbXBhcmUgYWRqYWNlbnQgcGFpcnNcbiAgICAgIGlmKCFTY3JvbGxpbmdNaWRwb2ludERpc3BsYWNlckxpbmtlZExpc3Quc2tpcFNwbGl0dGFibGVMaW5lKGwpKSB7XG4gICAgICAgIGNvbnN0IHNwbGl0IDogUGFpcjxTcGxpdHRhYmxlTGluZT4gPSBsLmdldFNwbGl0KHRoaXMudmVydGljYWxCb3VuZCk7XG4gICAgICAgIGxpbmVzLnNwbGl0QXQoaSwgc3BsaXQpO1xuICAgICAgfVxuICAgXG4gICAgICBpLS07XG4gICAgfVxuICB9XG5cbiAgLy8gU2hpZnRzIGFsbCB0aGUgbGluZSBzZWdtZW50cyBob3Jpem9udGFsbHlcbiAgcHVibGljIHNjcm9sbCgpIHtcbiAgICBjb25zdCBkZWx0YVggPSBTY3JvbGxpbmdNaWRwb2ludERpc3BsYWNlckxpbmtlZExpc3QuTUlOSU1VTV9MSU5FX1dJRFRIO1xuICAgIHRoaXMubGluZVNlZ21lbnRzLmZvckVhY2goKGw6IFNwbGl0dGFibGVMaW5lKSA9PiB7XG4gICAgICBsLnRyYW5zbGF0ZSgtMSpkZWx0YVgsIDApO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZSgpIHtcbiAgICB0aGlzLml0ZXJhdGlvbnMrKztcbiAgICAgIFxuICAgIC8vIERlcXVldWUgZWFybGllc3QgbGluZSBzZWdtZW50c1xuICAgIHRoaXMubGluZVNlZ21lbnRzLnBvcCgpO1xuXG4gICAgdGhpcy5kaXNwbGFjZSgpO1xuXG4gICAgLy8gRW5xdWV1ZSBuZXcgdW5kaXNwbGFjZWQgbGluZVxuICAgIGlmKHRoaXMuaXRlcmF0aW9ucyAlIHRoaXMuZW5xdWV1ZUludGVydmFsID09IDApIHtcbiAgICAgICAgdGhpcy5lbnF1ZXVlKCk7XG4gICAgfVxuXG4gICAgdGhpcy5zY3JvbGwoKTtcbiAgfVxuXG4gIC8vIENvbmRpdGlvbiB0byBzdG9wIGxvb3BpbmdcbiAgc3RhdGljIHNraXBTcGxpdHRhYmxlTGluZShsIDogU3BsaXR0YWJsZUxpbmUpIDogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGwuZ2V0R2VuZXJhdGlvbigpID49IFNjcm9sbGluZ01pZHBvaW50RGlzcGxhY2VyTGlua2VkTGlzdC5NQVhfR0VORVJBVElPTlMgLSAxO1xuICB9XG59IiwiaW1wb3J0IHtQYWlyfSBmcm9tICcuL3BhaXInO1xuXG4vKipcbiAqIGNsYXNzIHRvIHJlcHJlc2VudCBMaW5lIHNlZ21lbnQgd2l0aCBhZGRpdGlvbmFsIGRhdGEgZm9yIG1pZHBvaW50IGRpc3BsYWNlbWVudCBzcGxpdHRpbmdcbiAqL1xuXG5leHBvcnQgY2xhc3MgU3BsaXR0YWJsZUxpbmUge1xuICBzdGF0aWMgUk9VR0hORVNTOiBudW1iZXIgPSAuNjtcbiAgcHVibGljIGE6IFBhaXI8bnVtYmVyPjtcbiAgcHVibGljIGI6IFBhaXI8bnVtYmVyPjtcbiAgcHJpdmF0ZSBnZW5lcmF0aW9uOiBudW1iZXI7XG4gIHByaXZhdGUgYmFzZURpc3BsYWNlbWVudDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKGE6IFBhaXI8bnVtYmVyPiwgYjogUGFpcjxudW1iZXI+LCBnZW5lcmF0aW9uOiBudW1iZXIsIGJhc2VEaXNwbGFjZW1lbnQ6IG51bWJlcikge1xuICAgIHRoaXMuYSA9IGE7XG4gICAgdGhpcy5iID0gYjtcbiAgICB0aGlzLmdlbmVyYXRpb24gPSBnZW5lcmF0aW9uO1xuICAgIHRoaXMuYmFzZURpc3BsYWNlbWVudCA9IGJhc2VEaXNwbGFjZW1lbnQ7XG4gIH1cblxuICBwdWJsaWMgdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIGBMaW5lKCR7dGhpcy5hLnRvU3RyaW5nKCl9LT4ke3RoaXMuYi50b1N0cmluZygpfSlgO1xuICB9XG5cbiAgcHVibGljIGdldE1pZHBvaW50KCkgOiBQYWlyPG51bWJlcj4ge1xuICAgIGNvbnN0IHggPSAodGhpcy5iLnggKyB0aGlzLmEueCkgLyAyO1xuICAgIGNvbnN0IHkgPSAodGhpcy5iLnkgKyB0aGlzLmEueSkgLyAyO1xuICAgIHJldHVybiBuZXcgUGFpcjxudW1iZXI+KHgsIHkpO1xuICB9XG5cbiAgcHVibGljIG5leHREaXNwbGFjZW1lbnRNYWduaXR1ZGUoKSA6IG51bWJlciB7XG4gICAgY29uc3QgYmFzZURpc3BsYWNlbWVudFNjYWxlID0gMiAqKiAoLTEqU3BsaXR0YWJsZUxpbmUuUk9VR0hORVNTKTtcbiAgICBjb25zdCBkaXNwbGFjZW1lbnRTY2FsZSA9ICBiYXNlRGlzcGxhY2VtZW50U2NhbGUqKnRoaXMuZ2VuZXJhdGlvbjtcbiAgICByZXR1cm4gdGhpcy5iYXNlRGlzcGxhY2VtZW50ICogZGlzcGxhY2VtZW50U2NhbGU7XG4gIH1cblxuICBwdWJsaWMgZ2V0R2VuZXJhdGlvbigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmdlbmVyYXRpb247XG4gIH1cblxuICBwdWJsaWMgZ2V0QmFzZURpc3BsYWNlbWVudCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmJhc2VEaXNwbGFjZW1lbnQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0U3BsaXQodmVydGljYWxCb3VuZDogUGFpcjxudW1iZXI+KTogUGFpcjxTcGxpdHRhYmxlTGluZT4ge1xuICAgIGNvbnN0IGRpc3BsYWNlbWVudE1hZ25pdHVkZSA9IHRoaXMubmV4dERpc3BsYWNlbWVudE1hZ25pdHVkZSgpO1xuICAgIGNvbnN0IGxlZnRQb2ludCA6IFBhaXI8bnVtYmVyPiA9IHRoaXMuYTtcbiAgICBjb25zdCByaWdodFBvaW50IDogUGFpcjxudW1iZXI+PSB0aGlzLmI7XG5cbiAgICAvLyBDb21wdXRlIGRpc3BsYWNlZCBtaWRwb2ludFxuICAgIGNvbnN0IG1pZHBvaW50IDogUGFpcjxudW1iZXI+ID0gdGhpcy5nZXRNaWRwb2ludCgpO1xuICAgIGNvbnN0IHZlcnRpY2FsbHlEaXNwbGFjZWRNaWRwb2ludEEgOiBQYWlyPG51bWJlcj4gPSB0aGlzLmRpc3BsYWNlUG9pbnRWZXJ0aWNhbGx5KFxuICAgICAgbWlkcG9pbnQsIGRpc3BsYWNlbWVudE1hZ25pdHVkZSwgdmVydGljYWxCb3VuZCk7XG4gICAgY29uc3QgdmVydGljYWxseURpc3BsYWNlZE1pZHBvaW50QiA6IFBhaXI8bnVtYmVyPiA9IHZlcnRpY2FsbHlEaXNwbGFjZWRNaWRwb2ludEEuc2hhbGxvd0Nsb25lKCk7XG5cbiAgICBjb25zdCBnZW5lcmF0aW9uID0gdGhpcy5nZXRHZW5lcmF0aW9uKCkgKyAxO1xuICAgIGNvbnN0IGJhc2VEaXNwbGFjZW1lbnQgPSB0aGlzLmdldEJhc2VEaXNwbGFjZW1lbnQoKTtcbiAgICBjb25zdCBsZWZ0U3BsaXR0YWJsZUxpbmUgOiBTcGxpdHRhYmxlTGluZSA9IG5ldyBTcGxpdHRhYmxlTGluZShsZWZ0UG9pbnQsIHZlcnRpY2FsbHlEaXNwbGFjZWRNaWRwb2ludEEsIGdlbmVyYXRpb24sIGJhc2VEaXNwbGFjZW1lbnQpO1xuICAgIGNvbnN0IHJpZ2h0U3BsaXR0YWJsZUxpbmUgOiBTcGxpdHRhYmxlTGluZSA9IG5ldyBTcGxpdHRhYmxlTGluZSh2ZXJ0aWNhbGx5RGlzcGxhY2VkTWlkcG9pbnRCLCByaWdodFBvaW50LCBnZW5lcmF0aW9uLCBiYXNlRGlzcGxhY2VtZW50KTtcblxuICAgIHJldHVybiBuZXcgUGFpcihsZWZ0U3BsaXR0YWJsZUxpbmUsIHJpZ2h0U3BsaXR0YWJsZUxpbmUpO1xuICB9XG5cbiAgIHByaXZhdGUgZGlzcGxhY2VQb2ludFZlcnRpY2FsbHkocDogUGFpcjxudW1iZXI+LCBkaXNwbGFjZU1hZ25pdHVkZTogbnVtYmVyLCB2ZXJ0aWNhbEJvdW5kOiBQYWlyPG51bWJlcj4pIDogUGFpcjxudW1iZXI+e1xuICAgIGxldCB5ID0gcC55ICsgdGhpcy5jaG9vc2UoW2Rpc3BsYWNlTWFnbml0dWRlLCAtZGlzcGxhY2VNYWduaXR1ZGVdKTtcbiAgICBcbiAgICAvLyBCb3VuZCB0aGUgdmFsdWUgdG8gd2l0aGluIHdpbmRvd1xuICAgIHkgPSB0aGlzLmNsYW1wKHksIHZlcnRpY2FsQm91bmQueCwgdmVydGljYWxCb3VuZC55KTtcblxuICAgIHJldHVybiBuZXcgUGFpcihwLngsIHkpO1xuICB9XG5cbiAgICAvLyBQcml2YXRlIHN0YXRpYyBmaW5hbDogbW92ZSBpbnRvIHV0aWxpdHkgb3IgZ2xvYmFsLmQudHNcbiAgcHJpdmF0ZSBjaG9vc2UoY2hvaWNlczogQXJyYXk8YW55Pikge1xuICAgIHJldHVybiBjaG9pY2VzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNob2ljZXMubGVuZ3RoKV07XG4gIH1cblxuICBwcml2YXRlIGNsYW1wKHg6IG51bWJlciwgbG93ZXJCb3VuZDogbnVtYmVyLCB1cHBlckJvdW5kOiBudW1iZXIpIHtcbiAgICByZXR1cm4gTWF0aC5taW4odXBwZXJCb3VuZCwgTWF0aC5tYXgoeCwgbG93ZXJCb3VuZCkpO1xuICB9XG5cbiAgcHVibGljIHRyYW5zbGF0ZSh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHRoaXMuYS54ICs9IHg7XG4gICAgdGhpcy5hLnkgKz0geTtcbiAgICB0aGlzLmIueCArPSB4O1xuICAgIHRoaXMuYi55ICs9IHk7XG4gIH1cbn0iXX0=